!function(){"use strict";var e=document.querySelectorAll.bind(document),t=window.dataLayer=window.dataLayer||[],r="",c="",n=1e4;function o(){c=document.getElementById("mark-currency-code")?document.getElementById("mark-currency-code").value:"",r=function(){var e=location.pathname.split("/").concat([]).pop(),t="";window.isHome?t="home":"store"===e?t="store":"jcart"===e?t="jcart":"onepage"===e?t="checkout":location.pathname.indexOf("jcart/falcon/success")>=0?t="paymentSuccess":location.pathname.indexOf("sales/order/history")>=0&&location.search.indexOf("payment_status=error")>=0?t="paymentFail":0===e.indexOf("oneplus-")&&document.getElementById("data-device")?t="phoneModels":document.getElementById("data-recom")?t="accessoryDetail":location.pathname.indexOf("transaction/pay")>=0&&(t="cashRegister");return t}();try{!function(){switch(r){case"home":!function(e){var t=document.querySelector(".op-narrow-banner")&&document.querySelector(".op-narrow-banner").querySelectorAll(".banner-column .banner-button, .banner-column .learn-more"),r=document.querySelector(".op-home-promo")&&document.querySelector(".op-home-promo").querySelectorAll(".promo-item .item-link");if(t)var c=Array.prototype.filter.call(t,function(e){return e.innerText.trim()}).map(function(t){var r=t.getAttribute("promocr"),c=t.href,n=c+" | "+t.innerText,a=o(c),i={id:n,name:a,creative:r,position:t.getAttribute("promops")};return t.setAttribute("promonm",a),t.addEventListener("click",function(){e.push({event:"promotionClick",ecommerce:{promoClick:{promotions:[i]}}})}),i});if(r)var n=Array.prototype.map.call(r,function(t){var r=t.getAttribute("promocr"),c=t.href,n=c+" | "+t.querySelector(".subtitle").innerText,a=o(c),i={id:n,name:a,creative:r,position:t.getAttribute("promops")};return t.setAttribute("promonm",a),t.addEventListener("click",function(){e.push({event:"promotionClick",ecommerce:{promoClick:{promotions:[i]}}})}),i});c&&n&&e.push({event:"loadHome",ecommerce:{promoView:{promotions:c.concat(n)}}});function o(e){var t=e.match(/https:\/\/(.*)\?.*/),r=t&&t[1].split("/").pop()||"";return r||e}}(t);break;case"store":!function(e){var t=document.querySelector(".accessory-list-banner").querySelectorAll(".swiper-slide"),r=Array.prototype.filter.call(t,function(e){return!e.classList.contains("swiper-slide-duplicate")}).map(function(t){var r,c,n=t.querySelector(".link-clean"),o=n.getAttribute("promocr"),a=n.href,i=a,u=(c=(r=a).match(/https:\/\/(.*)\?.*/))&&c[1].split("/").pop()||r,s={id:i,name:u,creative:o,position:n.getAttribute("promops")};return n.setAttribute("promonm",u),n.addEventListener("click",function(){e.push({event:"promotionClick",ecommerce:{promoClick:{promotions:[s]}}})}),s});e.push({event:"loadProductList",ecommerce:{promoView:{promotions:r}}})}(t);break;case"phoneModels":!function(t){u(function(){var t=e(".choose-capacity .price-money");return!(!t.textContent||""==t.textContent.trim())},function(){!function(){var r=Array.prototype.map.call(e(".sku-option .as-phone-info"),function(e){return e});t.push({event:"loadProductDetail",ecomm_prodid:r.map(function(e){return e.value}),ecomm_pagetype:"product",ecommerce:{currencyCode:c,detail:{products:r.map(function(e){return{id:e.value,name:e.getAttribute("data-name"),price:Number(e.getAttribute("data-price")),category:"Device",dimension1:e.disabled?"Out of Stock":"In Stock"}})}}}),a();var n=e(".puppet.tab-nav-puppet");Array.prototype.forEach.call(n,function(e){e.addEventListener("click",function(){var t=e.getAttribute("for");"tab-nav-phone"===t&&setTimeout(function(){a()}),o="tab-nav-recoms"===t})})}()},n);var r=!1,o=!1;function a(){var n=e(".device-choose .checkbox-card")||[];function a(){var r=e(".device-choose .js-device.active")[0];t.push({event:"selectModel",model:r&&r.getAttribute("data-name")})}Array.prototype.forEach.call(n,function(e){e.addEventListener("click",function(e){a()})}),a(),o=!0,function(){r||(n=e(".choose-recoms .js-recom"),Array.prototype.forEach.call(n,function(r){r.addEventListener("click",function(){var r=this.firstElementChild.getAttribute("data-sku"),n=e(".recom-overlay[data-code="+r+"]")[0];if(n){var o=n.querySelector("[data-stock]"),a=n.querySelector(".js-name").textContent,i={id:n.getAttribute("data-code"),name:a&&a.trim(),price:Number(n.getAttribute("data-price")),category:s(n),dimension1:o&&1==o.getAttribute("data-stock")?"In Stock":"Out of Stock"};t.push({event:"popupAccessoryDetail",ecommerce:{currencyCode:c,detail:{products:i}}})}})}),r=!0);var n;u=e(".recom-overlay .btn-add-to-cart")||[],Array.prototype.forEach.call(u,function(e){e.addEventListener("click",function(e){var r=i(e.target,".recom-overlay"),c=r&&r.querySelector(".header-container .title").textContent;t.push({event:"addAccessory",model:c})})}),a=e(".as-add-to-cart")||[],Array.prototype.forEach.call(a,function(r){r.addEventListener("click",function(){if(o){var r=document.getElementById("data-stats")&&JSON.parse(document.getElementById("data-stats").innerHTML)||null,n=[];r&&(n.push({id:r.phone.sku,name:r.phone.name,price:Number(r.phone.discounted),category:"Device",quantity:1}),n=(n=n.concat(r.recoms.list.map(function(t){return{id:t.sku,name:t.name,price:Number(t.discounted),category:s(e('[data-code="'+t.code+'"]')[0]),quantity:1}}))).concat(r.insurance.list.map(function(e){return{id:e.sku,name:e.name,price:Number(e.discounted),category:"Insurance",quantity:1}})),t.push({event:"addProdToCart",ecomm_value:n.reduce(function(e,t){return e+t.price},0),ecomm_prodid:n.map(function(e){return e.id}),ecommerce:{currencyCode:c,add:{products:n}}}))}})}),!0;var a;var u}()}function s(e){if(!e)return"";var t="";return e.querySelector(".simple-step")?t="Accessory":e.querySelector(".series-steps")?t="Series":e.querySelector(".bundle-steps")&&(t="Bundle"),t}}(t);break;case"accessoryDetail":!function(t){var r=document.getElementById("data-recom")&&JSON.parse(document.getElementById("data-recom").innerHTML)||null,o=r&&function(e){var t={skus:[]};return e.simple&&(t.name=e.simple.name,t.category="Accessory",t.skus=t.skus.concat(e.simple.sku)),e.series&&e.series.skus&&(t.name=e.series.name,t.category="Series",t.skus=t.skus.concat(e.series.skus.map(function(e){return e.sku}))),e.bundle&&(t.skus=t.skus.concat(e.bundle.sku),t.name=e.bundle.name,t.category="Bundle"),t}(r)||[];function a(){var t=e(".recom-overlay")[0];return t?Number(e(".recom-overlay")[0].getAttribute("data-price")):0}u(function(){return a()>0},function(){!function(r){var n=document.querySelector(".btn-add-to-cart");n&&n.addEventListener("click",function(){var n="";n=r&&r.simple?document.querySelector(".simple-step .behind-stage-input").value:document.querySelector(".sku-step .behind-stage-input:checked").value;var i=a(),u=e(".recom-overlay .js-name")[0].textContent;t.push({event:"addProdToCart",ecomm_prodid:[n],ecomm_value:i,ecommerce:{currencyCode:c,add:{products:[{name:u&&u.trim(),id:n,price:i,quantity:1,category:o.category,dimension1:"In Stock"}]}}})}),t.push({ecomm_pagetype:"accessory detail",ecomm_prodid:o.skus,ecomm_value:a(),ecomm_category:["Accessory"]}),t.push({event:"loadProductDetail",ecomm_prodid:o.skus,ecommerce:{currencyCode:c,detail:{products:function(t){var r;return t&&t.series?Array.prototype.map.call(e(".behind-stage .behind-stage-input"),function(e){return{name:e.getAttribute("data-name"),id:e.getAttribute("data-sku"),price:e.getAttribute("data-price"),category:o.category,dimension1:1==e.getAttribute("data-stock")?"In Stock":"Out of Stock"}}):(r=a(),{name:o.name,id:o.skus&&o.skus[0],price:r,category:o.category,dimension1:r.length>0?"In Stock":"Out of Stock"})}(r)}}})}(r)},n)}(t);break;case"jcart":!function(t){function r(){var r=[{selector:".js-num-minus",action:"minus"},{selector:".js-num-add",action:"add"},{selector:".action-remove",action:"remove"}];e(".cart-items")[0].addEventListener("click",function(e){var n=e.target;r.forEach(function(e){if(n.matches(e.selector)){var r=n.classList.contains("disabled");if(!r){var o=i(n,".cart-item");!function(e,r,n){if(r){var o=d(r);switch(e){case"add":o.quantity=n||1,t.push({event:"cartIncrease",ecommerce:{currencyCode:c,add:{products:[o]}}});break;case"minus":o.quantity=n||1,t.push({event:"cartDecrease",ecommerce:{currencyCode:c,remove:{products:[o]}}});break;case"remove":t.push({event:"cartDelete",ecommerce:{currencyCode:c,remove:{products:[o]}}})}}}(e.action,o)}}})})}function o(e,r){var n=e||window.event,o=n.target||n.srcElement;if(o.matches(".btn-buy-recom")){var a=i(o,r),u=a.querySelector("[data-sku]").getAttribute("data-sku"),s=Number(a.querySelector("[data-price]").getAttribute("data-price"));t.push({event:"addProdToCart",ecomm_prodid:[u],ecomm_value:s,ecommerce:{currencyCode:c,add:{products:[{id:u,name:a.querySelector(".info-name").textContent,price:s,quantity:1,dimension1:"In Stock"}]}}})}}function s(){var t,r=e(".cart-items .cart-item"),c=Array.prototype.map.call(r,function(e){return d(e)}),n=(t=e(".item-recom"),Array.prototype.map.call(t,function(e){return{id:e.getAttribute("data-sku"),name:e.querySelector(".recom-name").textContent,price:Number(e.querySelector(".recom-price .price").getAttribute("data-price")),category:"Insurance",quantity:Number(e.querySelector(".recom-qty input").value),dimension1:"In Stock"}}));return c.concat(n)}function d(e){var t=e.getAttribute("data-sku");return{id:t,name:e.querySelector(".main-name a").textContent,price:Number(e.querySelector(".main-price .price").getAttribute("data-price")),category:function(e,t){return a(e)?"Device":t.querySelector(".item-recom")?"Device":t.querySelector(".item-detail")?"Bundle":"Accessory"}(t,e),quantity:Number(e.querySelector(".main-qty input").value),dimension1:e.querySelector(".main-name").hasAttribute("disabled")?"Out of Stock":"In Stock"}}u(function(){return e(".cart-items .cart-item").length>0},function(){var n,a,i=s(),u=i.map(function(e){return e.category});t.push({ecomm_pagetype:"cart",ecomm_value:i.reduce(function(e,t){return e+t.price*t.quantity},0),ecomm_prodid:i.map(function(e){return e.id}),ecomm_category:u}),e("#final_checkout")[0].addEventListener("click",function(){this.href;try{var e=s();t.push({event:"checkoutStep1-clickCheckout",ecommerce:{currencyCode:c,checkout:{actionField:{step:1,option:"Click Checkout"},products:e}}})}catch(e){}}),r(),n=e(".like-goods-list.cart-recommends-pc.row"),a=e(".swiper-wrapper.recommends"),Array.prototype.forEach.call(n,function(e){e.addEventListener("click",function(e){o(e,".like-goods-box")})}),Array.prototype.forEach.call(a,function(e){e.addEventListener("click",function(e){o(e,".swiper-slide.recommend")})})},n)}(t);break;case"paymentFail":!function(e){var t="";location.search.substring(1).split("&").some(function(e){if("msg"===e.split("=")[0])return t=decodeURIComponent(e.split("=")[1]),!0}),e.push({event:"transactionFailed",purchaseFailedReason:t})}(t);break;case"paymentSuccess":!function(e){var t=location.search.substring(1).split("&")[0].split("=")[1];function r(e){return e.salePrice*e.qty-(e.discount||0)}u(function(){return!(!window.successOrderData||!window.successOrderData.orderNo)&&void 0!==window.isFirstPaidOrder},function(){var c=window.successOrderData;if(c){var n=[],o=[];c.products.forEach(function(e){var t=e.insurance.length>0;n.push(e),t&&(o=o.concat(e.insurance))});var i=(n=n.concat(o)).map(function(e){return e.category=function(e,t){return a(e)?"Device":"1"===t.isInsurance?"Insurance":t.accessories.length>0?"Bundle":"Accessory"}(e.sku,e),e.category}),u=function e(t){return t.some(function(t){return!!a(t.sku)||!!(t.accessories&&t.accessories.length>0)&&e(t.accessories)})}(n),s=n.reduce(function(e,t){var c=0;if(a(t.sku))c=r(t);else if(t.accessories&&t.accessories.length>0){var n=t.accessories.some(function(e){return a(e.sku)});c=n?r(t):0}return+c+e},0),d=window._global&&window._global.skuListOf6T||["5011100538","5011100507","5011100508","5011100509","5011100539","5011100541","5011100513","5011100514","5011100515","5011100542","5011100543","5011100517","5011100518","5011100519","5011100544","5011100547","5011100525","5011100526","5011100527","5011100551"],m=n.reduce(function(e,t){var c=0;if(y(t.sku))c=r(t);else if(t.accessories&&t.accessories.length>0){var n=t.accessories.some(function(e){return y(e.sku)});c=n?r(t):0}return+c+e},0),p=n.reduce(function(e,t){return e+r(t)},0),l=[];!function e(t,r){t.forEach(function(t){1===t.skuType?(r.push({id:t.sku,quantity:t.qty,price:t.salePrice,discount:t.discount||0}),t.accessories&&t.accessories.length>0&&e(t.accessories,r)):2===t.skuType&&t.accessories&&t.accessories.length>0&&e(t.accessories,r)})}(c.products,l),e.push({ecomm_pagetype:"purchase",ecomm_prodid:n.map(function(e){return e.sku}),ecomm_value:p,ecomm_category:i}),e.push({event:"Transaction",orderType:u?"device":"default",phoneSaleAmount:s-(m||0),saleAmountOf6T:m.toFixed(2),accessorySaleAmount:(p-s).toFixed(2),userEmail:c.email,deliverCountry:c.address&&c.address[0]&&c.address[0].countryCode,estimatedDeliveryDate:c.warehouseInfo&&c.warehouseInfo.etaTime,ecommerce:{currencyCode:c.currency,purchase:{actionField:{id:t,affiliation:function(e){var t=("; "+document.cookie).split("; "+e+"=");if(2==t.length)return t.pop().split(";").shift()}("affiliation")||"",revenue:c.grandTotalPrice,tax:c.taxPrice,shipping:c.shippingPrice},products:n.map(function(e){return{id:e.sku,name:e.name,category:e.category,price:e.salePrice,quantity:e.qty}})}},isFirstPaidOrder:window.isFirstPaidOrder||!1,singleItemsList:l||[]})}function y(e){return d.some(function(t){return t===e})}},n)}(t);break;case"cashRegister":!function(t){var r=[];u(function(){return(r=e(".payment-method .payment-item input[type=radio]:checked")).length>0},function(){var e;e=document.getElementById("data-product")&&JSON.parse(document.getElementById("data-product").innerHTML)||null,r&&e&&(r=r[0],t.push({event:"checkoutStep5-paymentMethod",ecommerce:{currencyCode:e.symbol,checkout:{actionField:{step:5,option:r.getAttribute("data-name")},products:e.products}}}))},n)}(t);break;case"checkout":window.GLOBAL_CONFIG&&window.GLOBAL_CONFIG.isGray?function(t){var r;u(function(){return e(".order-product .product-detail").length>0},function(){var n=e(".order-product .product-detail");r=Array.prototype.map.call(n,function(e){var t=e.getAttribute("data-sku"),r=Number(e.getAttribute("data-price")),c=e.getAttribute("data-name"),n=Number(e.getAttribute("data-qty")),o=function(e,t){return a(e)?"Device":t.classList.contains("insurance-item")?"Insurance":t.querySelector(".product-accessories")?"Bundle":"Accessory"}(t,e);return{id:t,name:c&&c.trim(),price:r,category:o,quantity:n}}),t.push({event:"checkoutStep2-onePage",ecomm_prodid:r.map(function(e){return e.id}),ecomm_category:r.map(function(e){return e.category}),ecommerce:{currencyCode:c,checkout:{actionField:{step:2,option:"One Page"},products:r}}})},n),o=e("#shipping-address-confirm")[0],o&&o.addEventListener("click",function(){var n=e("#sp-add-block-main [name=selectedAddress-shipping-address]:checked");n&&t.push({event:"checkoutStep3-shippingAddress",ecommerce:{currencyCode:c,checkout:{actionField:{step:3,option:"adding"},products:r}}})}),function(){var n=e("#btn-falcon-place-order")[0];n&&n.addEventListener("click",function(e){var n=e.target.classList.contains("disabled");!n&&t.push({event:"CheckoutStep6-placeOrder",ecommerce:{currencyCode:c,checkout:{actionField:{step:6,option:"Place Order"},products:r}}})})}();var o}(t):function(t){var r;u(function(){return e(".r-product .detail").length>0},function(){var n=e(".r-product .detail");r=Array.prototype.map.call(n,function(e){var t=e.querySelector(".name").getAttribute("data-sku"),r=e&&Number(e.querySelector(".price").getAttribute("data-price")),c=e.querySelector(".name").textContent;return{id:t,name:c&&c.trim(),price:r,category:function(e,t){return a(e)||t.nextElementSibling?"Device":t.classList.contains("b-insurance")?"Insurance":t.querySelector(".b-buddle")?"Bundle":"Accessory"}(t,e),quantity:Number(e.querySelector(".num").textContent)}}),t.push({event:"checkoutStep2-onePage",ecomm_prodid:r.map(function(e){return e.id}),ecomm_category:r.map(function(e){return e.category}),ecommerce:{currencyCode:c,checkout:{actionField:{step:2,option:"One Page"},products:r}}})},n),o=e("#id-shipping-address .btn-continue")[0],i="",o.addEventListener("click",function(){var n=e("#id-shipping-address [name=shipping]:checked");n&&(n=n[0],i=0==n.value?"adding":"choosing",t.push({event:"checkoutStep3-shippingAddress",ecommerce:{currencyCode:c,checkout:{actionField:{step:3,option:i},products:r}}}))}),e("#checkout-shipping-method-list .btn-continue")[0].addEventListener("click",function(){var n=e("#checkout-shipping-method-list [name=shipmethod]:checked");n&&(n=n[0],t.push({event:"checkoutStep4-shippingMethod",ecommerce:{currencyCode:c,checkout:{actionField:{step:4,option:n.getAttribute("data-name")},products:r}}}))}),e("#checkout-payment-method-list .btn-continue")[0].addEventListener("click",function(n){if(!n.target.classList.contains("disabled")){var o=e("#checkout-payment-method-list [name=paymethod]:checked");o&&(o=o[0],t.push({event:"checkoutStep5-paymentMethod",ecommerce:{currencyCode:c,checkout:{actionField:{step:5,option:o.getAttribute("data-name")},products:r}}}))}}),e("#btn-falcon-place-order")[0].addEventListener("click",function(e){var n=e.target.classList.contains("disabled");!n&&t.push({event:"CheckoutStep6-placeOrder",ecommerce:{currencyCode:c,checkout:{actionField:{step:6,option:"Place Order"},products:r}}})});var o,i}(t)}}()}catch(e){console.error(e)}}function a(e){return e&&0===e.indexOf("501")}function i(e,t){for(;e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}function u(e,t,r){var c=Date.now();r=r||5e3;var n=setInterval(function(){(Date.now()-c>r||e())&&(clearInterval(n),t())},100)}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),r=t.length;--r>=0&&t.item(r)!==this;);return r>-1}),window.gtmDebug&&function(){console.log(t,c,r);var e=t.push;t.push=function(){e.apply(t,arguments),console.log(this)}}(),"complete"===document.readyState||"loaded"===document.readyState?o():document.addEventListener("DOMContentLoaded",function(){o()})}();
